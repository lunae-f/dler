<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DLer Web</title>
    <!-- Tailwind CSSをCDNから読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* スピナーアニメーション */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-left-color: #ffffff;
            border-radius: 50%;
            width: 2.5rem; /* w-10 */
            height: 2.5rem; /* h-10 */
            animation: spin 1s linear infinite;
        }
        /* カスタムグラデーション */
        .gradient-bg {
            background-color: #1a202c;
            background-image: radial-gradient(at 27% 37%, hsla(215, 98%, 61%, 0.3) 0px, transparent 50%), 
                              radial-gradient(at 97% 21%, hsla(145, 98%, 60%, 0.3) 0px, transparent 50%),
                              radial-gradient(at 75% 85%, hsla(260, 95%, 65%, 0.3) 0px, transparent 50%);
        }
    </style>
</head>
<body class="gradient-bg text-gray-200 flex items-center justify-center min-h-screen font-sans p-4">

    <main class="w-full max-w-lg">
        <div class="bg-gray-800 bg-opacity-50 backdrop-blur-xl border border-gray-700 rounded-2xl shadow-2xl overflow-hidden">
            
            <div class="p-8">
                <!-- ヘッダー -->
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-white tracking-tight">DLer Web</h1>
                    <p class="text-gray-400 mt-2">指定したURLのコンテンツをダウンロードします。</p>
                </div>

                <!-- フォーム -->
                <form id="download-form" class="space-y-4">
                    <div>
                         <label for="video-url" class="sr-only">動画のURL</label>
                         <input type="url" id="video-url" placeholder="ここにURLをペーストしてください" required class="w-full px-5 py-3.5 bg-gray-900 bg-opacity-70 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-teal-500 focus:border-teal-500 focus:outline-none transition duration-200">
                    </div>
                    <button type="submit" id="submit-button" class="w-full inline-flex items-center justify-center px-6 py-3.5 bg-teal-600 text-white font-bold rounded-lg shadow-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-teal-500 disabled:opacity-60 disabled:cursor-wait transition-transform transform hover:scale-105 duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        <span>ダウンロード開始</span>
                    </button>
                </form>
            </div>

            <!-- ステータス表示エリア -->
            <div id="status-container" class="bg-gray-900 bg-opacity-50 px-8 py-6 text-center" style="display: none;">
                <!-- ローディングスピナー -->
                <div id="loader" class="flex justify-center items-center flex-col space-y-3">
                    <div class="spinner"></div>
                    <p class="text-gray-300 font-semibold">リクエスト処理中...</p>
                    <p class="text-sm text-gray-400">これには数分かかる場合があります。</p>
                </div>

                <!-- 結果表示 -->
                <div id="result" class="hidden">
                    <div id="success-message" class="hidden text-green-300 font-semibold mb-3">
                        <p>✓ 準備が完了しました！</p>
                    </div>
                     <div id="error-message" class="hidden text-red-400 font-semibold mb-3">
                        <p>✖ エラーが発生しました</p>
                        <p id="error-text" class="text-sm font-normal mt-1"></p>
                    </div>
                    <a id="download-link" href="#" class="inline-flex items-center justify-center w-full sm:w-auto px-5 py-3 text-base font-medium text-center text-gray-900 bg-green-400 rounded-lg hover:bg-green-500 focus:ring-4 focus:ring-green-300 transition duration-200">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-4-4V7a4 4 0 014-4h10a4 4 0 014 4v5a4 4 0 01-4 4H7z" />
                           <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-3-3l-1 1m6 0l1-1m-3-6a3 3 0 100-6 3 3 0 000 6z" />
                         </svg>
                        <span id="download-title"></span>
                    </a>
                </div>
            </div>
            
        </div>
        <footer class="text-center mt-6 text-xs text-gray-500">
            <p>著作権で保護されたコンテンツのダウンロードは、法律で禁止されている場合があります。自己の責任においてご利用ください。</p>
        </footer>
    </main>

    <script>
        // JavaScriptのロジックは前回とほぼ同じため、変数名のみ新しいIDに合わせて調整
        const form = document.getElementById('download-form');
        const videoUrlInput = document.getElementById('video-url');
        const submitButton = document.getElementById('submit-button');
        
        const statusContainer = document.getElementById('status-container');
        const loader = document.getElementById('loader');
        const resultDiv = document.getElementById('result');
        
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        
        const downloadLink = document.getElementById('download-link');
        const downloadTitle = document.getElementById('download-title');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // UIをリセットしてローディング状態へ
            submitButton.disabled = true;
            statusContainer.style.display = 'block';
            loader.style.display = 'flex';
            resultDiv.classList.add('hidden');
            successMessage.classList.add('hidden');
            errorMessage.classList.add('hidden');
            
            const url = videoUrlInput.value;

            try {
                const response = await fetch('/api/download', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url }),
                });

                const data = await response.json();
                
                loader.style.display = 'none';
                resultDiv.classList.remove('hidden');

                if (response.ok) {
                    successMessage.classList.remove('hidden');
                    downloadLink.href = data.download_url;
                    downloadLink.setAttribute('download', data.title);
                    downloadTitle.textContent = `「${data.title || 'ファイル'}」を保存`;
                } else {
                    errorMessage.classList.remove('hidden');
                    errorText.textContent = data.error || '不明なエラーが発生しました。';
                }

            } catch (error) {
                loader.style.display = 'none';
                resultDiv.classList.remove('hidden');
                errorMessage.classList.remove('hidden');
                errorText.textContent = 'サーバーとの通信に失敗しました。';
            } finally {
                submitButton.disabled = false;
            }
        });
    </script>
</body>
</html>
